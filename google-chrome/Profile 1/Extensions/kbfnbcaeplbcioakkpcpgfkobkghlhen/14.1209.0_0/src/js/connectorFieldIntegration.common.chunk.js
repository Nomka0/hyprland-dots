(self.webpackChunk=self.webpackChunk||[]).push([[5058],{75442:(e,t,n)=>{n.r(t),n.d(t,{ConnectorFieldIntegration:()=>oe,ConnectorFocusFieldManagerImpl:()=>h});var i=n(65882),o=n(14765),r=n(65647),s=n(60165),a=n(70163),c=n(25770),l=n(59641),u=n(16711),d=n(42530);class h{constructor(e){this._params=e,this._fieldRegistry=c.h.create([]),this._textFieldsObservable=l.S.createFocusObservable(this._params.doc,u.x.createFlattenHot(this._params.doc,{childList:!0,subtree:!0})),this._focusedTextField=i.aj([this._fieldRegistry,this._textFieldsObservable.pipe(o.O(null))]).pipe(r.U((([e,t])=>{var n;const[i]=e;if(!t)return null==i?void 0:i.documentID;const o=e.find((e=>{var n;return t.element instanceof HTMLElement&&([e.textField,e.originalTextField].includes(t.element)||e.textField.contains(t.element)||(0,d.fQ)(null===(n=e.originalTextField)||void 0===n?void 0:n.contains(t.element)))}));return null!==(n=null==o?void 0:o.documentID)&&void 0!==n?n:null==i?void 0:i.documentID})),s.x(),a.B())}createFocusFieldIntegration(e){return this._fieldRegistry.modify((t=>[...t,e])),{isFocused:this._focusedTextField.pipe(r.U((t=>t===e.documentID)),s.x(),o.O(!0)),dispose:()=>this._fieldRegistry.modify((t=>t.filter((t=>t!==e))))}}}var g=n(58303),m=n(69342),p=n(69391),f=n(55901),x=n(48328),_=n(31393),y=n(87175),C=n(88241),v=n(2678),b=n(31013),F=n(21768),D=n(82823),S=n(60841),T=n(17888),R=n(34859),w=n(20715),B=n(1393),O=n(1933);class L{constructor(e,t=C.Y.create("ConnectorApi")){this._params=e,this._log=t,this._subscription=new D.w;const n={id:e.documentID,getDocumentText:this._getDocumentText.bind(this),getDocumentGeometry:this._getDocumentGeometry.bind(this),getBoundingBoxesForTextRanges:this._getBoundingBoxesForTextRanges.bind(this),setDocumentSelectedTextRanges:this._setDocumentSelectedTextRanges.bind(this),applyChangesToDocument:this._applyChangesToDocument.bind(this),dispose:e.disposeConnection,cancel:d.EI};[e.connectorServer.createConnectorSession(e.documentID,n),this._listenDocumentFocuseChange(),this._listenDocumentTextDidChange(),this._listenDocumentSelectedTextRangesDidChange(),this._listenDocumentGeometryChange()].forEach((e=>this._subscription.add(e)))}_getDocumentText(e){const t={...this._documentState,document:this._params.connectorHandler.getDocumentText()};return this._log.trace(`[${this._params.documentID}] handle getDocumentText:`,t),Promise.resolve(t)}_getDocumentGeometry(e){const t={...this._documentState,...this._params.connectorHandler.getDocumentGeometry()};return this._log.trace(`[${this._params.documentID}] handle getDocumentGeometry:`,t),Promise.resolve(t)}_getBoundingBoxesForTextRanges(e){const{ranges:t}=e,n={...this._documentState,boundingBoxes:this._params.connectorHandler.getBoundingBoxesForTextRanges(t)};return this._log.trace(`[${this._params.documentID}] handle getBoundingBoxesForTextRanges:`,{ranges:t,result:n}),Promise.resolve(n)}_setDocumentSelectedTextRanges(e){const[t]=e.ranges;return this._params.connectorHandler.setDocumentSelectedTextRange(t),this._log.trace(`[${this._params.documentID}] handle setDocumentSelectedTextRange:`,{range:t}),Promise.resolve()}_applyChangesToDocument(e){return this._params.connectorHandler.applyChangesToDocument(new F.i(e.changes)).then((t=>{this._log.trace(`[${this._params.documentID}] handle applyChangesToDocument:`,{changes:e.changes,result:t})}))}_listenDocumentFocuseChange(){this._params.connectorListener.focusChangeObs.pipe(S.w((e=>e?T.timer(B.Xd(4)).pipe(R.h(e)):w.of(e))),(0,O.i6)(!1,((e,t)=>t||e))).subscribe((e=>{const t=e?{...this._documentState,documentURL:this._params.documentURL}:null;this._params.connectorServer.client.api.documentDidFocus(t),this._log.trace(`[${this._params.documentID}] documentDidFocus:`,t)}))}_listenDocumentTextDidChange(){return this._params.connectorListener.textChangeObs.subscribe((e=>{const t={...this._documentState,changes:e};this._params.connectorServer.client.api.documentTextDidChange(t),this._log.trace(`[${this._params.documentID}] documentTextDidChange:`,t)}))}_listenDocumentSelectedTextRangesDidChange(){return this._params.connectorListener.selectionChangeObs.subscribe((e=>{const t={...this._documentState,ranges:e?[e]:[]};this._params.connectorServer.client.api.documentSelectedTextRangesDidChange(t),this._log.trace(`[${this._params.documentID}] documentSelectedTextRangesDidChange:`,t)}))}_listenDocumentGeometryChange(){return this._params.connectorListener.geometryChangeObs.subscribe((e=>{const t={...this._documentState,reasons:e.reasons};this._params.connectorServer.client.api[e.eventName](t),this._log.trace(`[${this._params.documentID}] ${e.eventName}:`,t)}))}_documentDidDestroy(){const e=this._documentState;return this._log.trace(`[${this._params.documentID}] documentDidDestroy:`,e),this._params.connectorServer.client.api.documentDidDestroy(e)}get _documentState(){return{documentID:this._params.documentID,revision:this._params.textRevisionManager.getLatestVersionNumber()}}dispose(){this._documentDidDestroy(),this._subscription.unsubscribe()}}var I,G=n(26966),q=n(90023),M=n(6128),k=n(72521),H=n(81772),U=n(42002);!function(e){function t(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}function n(e){const t=e.rect.getCurrent();return{left:t.client.left,top:t.client.top,width:t.size.width,height:t.size.height}}function i(e){const t=e.visibleRect.getCurrent(),n=e.rect.getCurrent(),i=e.scroll.getCurrent(),o=(0,M.jg)(t,n);return o?(0,M.Li)(o,n,i):null}function o(e,t,n,i,o){var r;const s=i.create(e,t);return s?Array.from(null!==(r=i.getClientRects(s))&&void 0!==r?r:[]).filter((e=>e.height>0&&e.width>0)).map((e=>k.UL.setPosition(o.clientToRelative(e),e))).filter((e=>k.UL.contains(e,n))):[]}function r(e,t,n){return[[e.left,e.top+e.height],[e.left+e.width,e.top+e.height]].map((([e,n])=>t.elementFromPoint(e,n))).every((e=>n.some((t=>e===t||t.contains(e)))))}function s(e){return Object.fromEntries(Object.keys(e).map((e=>[e,[]])))}e.getTextFieldBoundingBox=function(e,i){const o=n(i),r=(0,H.k6)(e);if(!r)return t(o);const s=k.UL.getIntersection(o,r);return t(s?{...s,top:o.top,height:o.height}:o)},e.getRelativeVisibleTextFieldRect=i,e.getVisibleRelativeRectsForTextRange=o,e.getVisibleTextRange=function(e,t,n,r){let s=null;const a=e.getPlainText(),c=i(t);if(!c||!a.length)return s;const l=r.getCurrentConversionContext();for(let t=0;t<a.length;t++){if(o({start:t,end:t+1},e,c,n,l).length>0)s={start:null===s?t:s.start,end:t+1};else if(s&&(0,U.qE)(a.substring(t,t+1)))break}return s},e.isRectElementOnDocumentTop=r,e.createEmptyBoundingBoxesForTextField=s,e.getBoundingBoxesForTextRanges=function(e,a,c,l,u,h,g,m){const p=i(h);if(!p)return s(e);const f=g.getCurrentConversionContext(),x=n(h),_=t(x),y=h.scroll.getCurrent(),C={left:x.left-y.left,top:x.top-y.top},v={left:_.x-y.left,top:_.y-y.top};return Object.fromEntries(Object.entries(e).map((([e,n])=>[e,o(n,u,p,m,f).filter((e=>r(k.UL.shift(e,C),l,[a,c].filter(d.fQ)))).map((e=>(0,q.zG)(k.UL.shift(e,v),t)))])))}}(I||(I={}));class j{constructor(e){this._params=e,this.getDocumentText=()=>this._params.getCurrentTextMap().getRichText(),this.getDocumentGeometry=()=>{const e=I.getVisibleTextRange(this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryProvider,this._params.geometryLayout),t=I.getTextFieldBoundingBox(this._params.textField,this._params.textFieldLayout);return e?{visibleTextRange:e,documentFrame:t}:{documentFrame:t}},this.getBoundingBoxesForTextRanges=e=>I.getBoundingBoxesForTextRanges(e,this._params.textField,this._params.originalTextField,this._params.doc,this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryLayout,this._params.geometryProvider),this.setDocumentSelectedTextRange=e=>this._params.selectionService.setSelection(e),this.applyChangesToDocument=e=>{const t=(0,G.g)(e,!0);return this._params.replacementService.performBatchReplacements(t).then((t=>({changes:e,status:t})))}}}var E,P=n(64965),$=n(90049),N=n(5794),W=n(55446),z=n(53710);!function(e){e.WindowFrameChanged="WindowFrameChanged",e.ViewportFrameChanged="ViewportFrameChanged",e.DocumentFrameChanged="DocumentFrameChanged",e.DocumentFrameScrolled="DocumentFrameScrolled",e.DocumentTextReflow="DocumentTextReflow"}(E||(E={}));var Q,V,A,J=n(19775),X=n(77089);!function(e){function t(e,n=[]){const i=e.parentElement;if(!i)return n;const o=i.scrollWidth>i.clientWidth,r=i.scrollHeight>i.clientHeight;return(o||r)&&n.push(i),t(i,n)}e.getScrollableParents=t,e.getParentsScrollObs=function(e){const n=t(e);return i.aj(n.map((e=>P.R(e,"scroll").pipe(o.O(null))))).pipe(N.J(),W.h((e=>(0,d.fQ)(e))))},e.getGlobalScrollObs=function(e){const t=(0,f.Jj)(e);return i.aj([P.R(t,"scroll").pipe(o.O(null)),t.top&&t.top!==t?P.R(t.top,"scroll").pipe(o.O(null)):w.of(null)]).pipe(N.J(),W.h((e=>(0,d.fQ)(e))))}}(Q||(Q={})),function(e){e.documentGeometryWillChange="documentGeometryWillChange",e.documentGeometryDidChange="documentGeometryDidChange"}(V||(V={})),function(e){function t({willChangeBuffer:e,didChangeBuffer:t}){return{willChangeBuffer:e,didChangeBuffer:t}}e.debounceGeometryUpdateReason=function(e,t=B.E0){return n=>n.pipe(R.h(e),S.w((e=>T.timer(t).pipe(R.h([V.documentGeometryDidChange,e]),o.O([V.documentGeometryWillChange,e])))),s.x((([e],[t])=>e===t)),o.O(null))},e.updateGeometryState=function(e,[n,i]){if(n===V.documentGeometryWillChange)return e.willChangeBuffer.has(i)?t(e):(e.willChangeBuffer.add(i),{...e,event:{eventName:n,reasons:[i]}});if(!(e.willChangeBuffer.size>0))return t(e);if(e.didChangeBuffer.add(i),e.willChangeBuffer.delete(i),e.didChangeBuffer.size>0&&0===e.willChangeBuffer.size){const t=Array.from(e.didChangeBuffer);return e.didChangeBuffer.clear(),{...e,event:{eventName:n,reasons:t}}}return t(e)},e.createInitialGeometryState=function(){return t({willChangeBuffer:new Set,didChangeBuffer:new Set})}}(A||(A={}));class Y{constructor(e){this._params=e,this.focusChangeObs=i.aj([this._params.isCurrentFieldFocused,P.R(this._params.doc,"visibilitychange",{passive:!0}).pipe(r.U((()=>"visible"===this._params.doc.visibilityState)),s.x(),o.O("visible"===this._params.doc.visibilityState)),X.N.create((()=>this._params.doc.hasFocus()),J.S.hz10,d.fS).changes.pipe(s.x(),o.O(this._params.doc.hasFocus()))]).pipe(r.U((([e,t,n])=>e&&t&&n)),s.x()),this.textChangeObs=(0,O.xy)(this.focusChangeObs,this._params.textRevisionManager.revisionChanges.pipe(r.U((e=>e.deltaChanges.delta)))),this.selectionChangeObs=(0,O.xy)(this.focusChangeObs,this._params.selectionService.selection),this.geometryChangeObs=(0,O.xy)(this.focusChangeObs,$.T([$.T(Q.getGlobalScrollObs(this._params.textField),Q.getParentsScrollObs(this._params.textField),this._params.textFieldLayout.scroll.changes).pipe(A.debounceGeometryUpdateReason(E.DocumentFrameScrolled)),this._params.textFieldLayout.rect.changes.pipe(A.debounceGeometryUpdateReason(E.DocumentFrameChanged))]).pipe(N.J(),W.h(d.fQ),z.R(A.updateGeometryState,A.createInitialGeometryState()),r.U((e=>e.event)),W.h(d.fQ)))}}var K,Z=n(88004),ee=n(91059);!function(e){e.create=function(e,t=Z.n.create){const n=t({getTextSource:()=>e.getTextSource(),getCurrentTextMap:()=>e.getCurrentTextMap(),dispose:()=>e.dispose(),textMapChanged:e.textMapChanged,contentChanges:{async:e.contentChanges.async.pipe(W.h((e=>e.changes.length>0))),immediate:e.contentChanges.immediate.pipe(W.h((e=>e.changes.length>0)))}});return{revisionChanges:n.revisionChanges,getLatestVersionNumber:()=>ee.Q.getRevisionNumber(n.getLatestRevision().id),dispose:()=>n.dispose()}}}(K||(K={}));var te=n(80223),ne=n(16470);class ie{constructor(e){this._params=e,this._subscription=new D.w,this._selection=c.h.create(null),this.selection=this._selection.view(),this._subscription.add(e.selectionOrCaretPosition.pipe(r.U((e=>g.WG(e))),r.U((t=>null!=t?t:(0,q.zG)(e.selectionService.getCurrentSelection(),ne.Ey)))).subscribe(te.wW(this._selection)))}setSelection(e){this._params.selectionService.setSelection(e)}dispose(){this._subscription.unsubscribe()}}class oe{constructor(e,t){var n,i,o;this._params=e,this._disposableList=[],this._log=C.Y.create("ConnectorFieldIntegration");const r=(0,f.Me)(e.textField),s=r.location.href,a=d.iy.create(),l=null!==(n=e.sessionStatsManager)&&void 0!==n?n:new p.J(e.domain,(()=>c.h.create(null)),(()=>g.YP),e.textObserver,e.gnar,e.productMetricsCSClient,e.felog,e.experimentClient),u=x.L.create(e.createReplacementService,e.textObserver,e.domain,e.integrationName,e.felog,l,null!==(i=e.layout.isIframeHost)&&void 0!==i&&i,e.experimentClient,e.state.view("dynamicConfig").get(),new _.M,e.productMetricsCSClient).create(y.P.connector),h=K.create(e.textObserver,e.createTextRevisionManager),b=null!==(o=e.geometryLayout)&&void 0!==o?o:e.layout.createGeometryLayout(),F=new ie({selectionService:e.selectionService,selectionOrCaretPosition:e.selectionOrCaretPosition}),D=t.connectorFocusFieldManager.createFocusFieldIntegration({documentID:a,textField:e.textField,originalTextField:e.originalTextField}),S=new Y({doc:r,selectionService:F,textRevisionManager:h,textField:e.textField,textFieldLayout:e.layout.textField,isCurrentFieldFocused:D.isFocused}),T=new j({doc:r,replacementService:u,textRevisionManager:h,geometryLayout:b,selectionService:F,textField:e.textField,textFieldLayout:e.layout.textField,originalTextField:e.originalTextField,geometryProvider:e.geometryProvider,getCurrentTextMap:()=>e.textObserver.getCurrentTextMap()}),R=new L({documentID:a,documentURL:s,textRevisionManager:h,connectorListener:S,connectorHandler:T,connectorServer:t.connectorServer,disposeConnection:t.disposeConnection});e.typingTracker.then((t=>{var n;return this._disposableList.push(t.registerFieldIntegration(m.O.connector,null!==(n=e.originalTextField)&&void 0!==n?n:e.textField,e.integrationName,e.textObserver))})),this._disposableList.push(R,l,h,F,D),this._registerDevtoolsHelper(T),this._log.debug("Initialized Connector Field Integration!"),this._params.felog.connector.textFieldIntegrated((0,v.FN)(this._params.domain),this._params.integrationName)}update(e){this._params.state.set(e)}dispose(){this._disposableList.forEach(((e,t)=>{try{e.dispose()}catch(n){this._log.error(`cannot dispose disposable ${String(e)} with index ${t}:`,n)}}))}_registerDevtoolsHelper(e){(0,b.X)("connectorApi",{getDocumentText:e.getDocumentText,getDocumentGeometry:e.getDocumentGeometry,getBoundingBoxesForTextRanges:e.getBoundingBoxesForTextRanges,setDocumentSelectedTextRanges:e.setDocumentSelectedTextRange,applyChangesToDocument:e.applyChangesToDocument})}}},81772:(e,t,n)=>{if(n.d(t,{LJ:()=>f,Nd:()=>a,Ov:()=>p,TW:()=>C,Ur:()=>c,Xs:()=>v,e$:()=>_,eg:()=>y,fN:()=>d,k6:()=>g,kh:()=>u,lW:()=>x,lz:()=>h,qg:()=>s,uj:()=>r,uz:()=>m}),3075==n.j)var i=n(44025);var o=n(55362);function r(e){const t=(0,i.Cq)(e.querySelector(o.XG),"text buffer iframe");return(0,i.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function s(e){const t=a(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function a(e){return e.querySelector(o.Wp)}function c(e,t,n){return t?function(e,t){if(t&&l(t))return t;const n=e.querySelectorAll(o.Qy);for(const e of n)if(l(e))return e;return null}(e,n):e.querySelector(o.Qy)}const l=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function u(e){return e.querySelectorAll(o.gH)}function d(e){return e.querySelector(o.gH)}function h(e){return Boolean(e.querySelector(o.gH))}function g(e){let t=e.querySelector(o.os);return t||(t=document.querySelector(o.gH)),t?t.getBoundingClientRect():null}const m=e=>!!e.querySelector(o.Lq);function p(e){return e.querySelector(o.$x)}function f(e){return null==e?void 0:e.querySelector(o.y1)}function x(e){const t=e.querySelector(o.f);return!!t&&t.offsetHeight>0}function _(e){return!!e.querySelector(`${o.jW}, ${o.F8}`)}function y(){const e=document.querySelector(o.d0),t=(null==e?void 0:e.classList.contains(o.uj))?"edit":void 0,n=(null==e?void 0:e.classList.contains(o._m))?"suggesting":void 0;return t||n||"other"}function C(e){return e.querySelector(o.QR)}function v(e){return e.querySelector(o.ij)}},55362:(e,t,n)=>{n.d(t,{$x:()=>s,F8:()=>p,Go:()=>o,Kt:()=>v,Lq:()=>l,QR:()=>R,Qy:()=>x,Vk:()=>b,Wp:()=>i,XG:()=>r,_m:()=>h,d0:()=>u,f:()=>c,gH:()=>f,gL:()=>F,ij:()=>T,j5:()=>C,jW:()=>m,l$:()=>g,lO:()=>S,os:()=>y,rx:()=>D,uj:()=>d,y1:()=>a,yw:()=>_});const i=".kix-appview-editor",o=".docos-input",r=".docs-texteventtarget-iframe",s=".kix-cursor",a=".kix-cursor-caret",c="#docs-revisions-sidebar",l='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',u="#docs-toolbar-mode-switcher",d="edit-mode",h="suggest-mode",g="titlebar-mode-indicator-container",m="#titlebar-mode-indicator-container .titlebar-request-access-button",p="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",f="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",x=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",_=".kix-page-paginated",y=".kix-page-paginated.canvas-first-page",C=".docs-horizontal-ruler",v=".docs-vertical-ruler",b="#fontSizeSelect input",F=".docs-ruler-background",D=".docs-ruler-background-inner",S=".docs-ruler-indent-first-line",T=".modal-dialog.docs-dialog .fatal-error-message",R='#docs-titlebar-share-client-button div[role="button"]'}}]);