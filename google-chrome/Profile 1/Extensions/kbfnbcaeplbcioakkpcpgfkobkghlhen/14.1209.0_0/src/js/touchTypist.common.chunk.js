(self.webpackChunk=self.webpackChunk||[]).push([[1824],{66875:(e,t,r)=>{r.r(t),r.d(t,{TouchTypistFeatureImpl:()=>Je,trackTooltipAppearingAndSkipping:()=>Qe});var a=r(90023),s=r(82823),i=r(65647),n=r(70989),o=r(55446),c=r(34859),l=r(96030),p=r(58303),h=r(72106),d=r(49231),u=r(90049),g=r(64965),m=r(60165),v=r(60841),_=r(20715),y=r(27628),f=r(72600),T=r(17888),E=r(68259),b=r(77530),w=r(94161),S=r(73309),x=r(59330),R=r(71301),I=r(24519),C=r(1393),P=r(50845);const A=({hotkeyName:e})=>d.createElement("div",{className:P.hotkeyComponentWrapperStyles},d.createElement("div",{className:P.hotkeyNameStyles},e)),D=({top:e,left:t,hotkeyName:r,errorsCount:a,shouldShowSettingsIcon:s,softOnboardingState:i=I.kH.Off})=>{const[n,o]=d.useState(!1),[c,l]=d.useState(!1),[p,h]=d.useState(!1);d.useEffect((()=>{T.timer(C.m9(4)).subscribe((()=>h(!0)))}),[]);const u=d.createElement("button",{onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),className:P.buttonStyles,style:{top:e,left:t-6}},d.createElement(A,{hotkeyName:r})),g=a?`To fix ${a} ${1===a?"error":"errors"}, press`:"To fix errors, press",m=a?`to fix ${a} ${1===a?"error":"errors"}`:"to fix errors",{width:v,leftAlignedOffset:_,rightAlignedOffset:y}=function(e,t,r){if(r){if(r){if(t&&1===t)return{width:178,rightAlignedOffset:e-154,leftAlignedOffset:e-63};if(t&&t<10)return{width:184,rightAlignedOffset:e-148,leftAlignedOffset:e-63};if(t&&t>=10)return{width:199,rightAlignedOffset:e-160,leftAlignedOffset:e-63};if(!t)return{width:174,rightAlignedOffset:e-138,leftAlignedOffset:e-63}}}else{if(t&&1===t)return{width:162,rightAlignedOffset:e-143,leftAlignedOffset:e-63};if(t&&t<10)return{width:168,rightAlignedOffset:e-148,leftAlignedOffset:e-63};if(t&&t>=10)return{width:183,rightAlignedOffset:e-160,leftAlignedOffset:e-63};if(!t)return{width:158,rightAlignedOffset:e-138,leftAlignedOffset:e-63}}return{width:155,rightAlignedOffset:128,leftAlignedOffset:128}}(t,a,s),D=t<160,k=d.createElement("div",null,d.createElement("div",{className:P.expandedButtonContainer,"data-testid":"expanded-button",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1)},d.createElement(b.k,{align:"start",className:P.expandedButtonStyles,style:{width:f.ux.px(v),height:f.ux.px(24),top:e,left:y}},d.createElement(w.J,{style:{transform:"scale(0.6)",margin:"2px 0"},icon:S.p,accessibilityLabel:"Grammarly logo",className:P.grammarlyLogo}),d.createElement(x.x,{"data-testid":"expanded-text",as:"p",variant:"text-xsmall",className:P.textStyles},g),s&&d.createElement(R.v,{"data-testid":"options-menu",activator:"more-vertical",accessibilityLabel:"Settings",className:P.menuStyles},d.createElement(R.v.Item,{key:"turn-off-tt"},"Turn of Quick Fix")))),u),L=d.createElement("div",null,d.createElement("div",{className:P.expandedButtonContainerLeft,"data-testid":"expanded-button",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1)},d.createElement(b.k,{align:"start",className:P.expandedButtonStyles,style:{width:f.ux.px(v),height:f.ux.px(24),top:e,left:_}},d.createElement(w.J,{style:{transform:"scale(0.6)",margin:"2px 0"},icon:S.p,accessibilityLabel:"Grammarly logo",className:P.grammarlyLogo}),d.createElement(x.x,{"data-testid":"expanded-text",as:"p",variant:"text-xsmall",className:P.textStyles},"Press"),d.createElement(x.x,{"data-testid":"expanded-text",as:"p",variant:"text-xsmall",className:P.textStylesLeft},m),s&&d.createElement(R.v,{"data-testid":"options-menu",activator:"more-vertical",accessibilityLabel:"Settings",className:P.menuStylesLeft},d.createElement(R.v.Item,{key:"turn-off-tt"},"Turn of Quick Fix")))),u),N=D?L:k;switch(i){case I.kH.Initial:return N;case I.kH.Transitional:return p?n||c?N:u:N;case I.kH.Off:return n||c?N:u;default:(0,E.L0)(i)}};var k=r(23729);const L=({top:e,left:t})=>d.createElement("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",style:{top:e,left:t,position:"fixed"},className:k.bubble},d.createElement("path",{d:"M0 7.00023C0 3.13372 3.13344 0 7.00035 0C10.8673 0 14 3.13372 14 7.00023C14 10.3829 11.6017 13.2049 8.41204 13.8581C7.95631 13.9515 7.48418 14 7.00246 14H0V7.00023Z",fill:"#027E6F"}),d.createElement("path",{d:"M3.92422 7.57649L5.8528 9.50507L10.3528 5.00507",stroke:"white",strokeWidth:"1.25",className:k.checkmark}));var N=r(82675);const O=({top:e,left:t})=>d.createElement(b.k,{"data-testid":"loading-dots",justify:"center",align:"start",style:{top:e,left:t+1,position:"fixed",width:"25px"}},d.createElement("div",{className:N.dot}),d.createElement("div",{className:N.dot}),d.createElement("div",{className:N.dot}));var M,U,G,F=r(21768),B=r(25770),V=r(18820);!function(e){function t(e,t){const r=e.ops[0];return r&&V.s.isRetain(r)?{...e,ops:[{retain:t+r.retain},...e.ops.slice(1)]}:e}e.offsetDelta=t,e.rebaseByAppliedPreview=function(e){const r=function(e){const t=e.end-e.begin;return e.replacement.length-t}(e);return 0===r?a.yR:a=>a.begin>=e.end?{...a,delta:t(a.delta,r),previewDelta:t(a.previewDelta,r)}:a},e.normalize=function(e){return r=>({...r,begin:e+r.begin,end:e+r.end,delta:t(r.delta,e),previewDelta:t(r.previewDelta,e),highlight:{s:e+r.highlight.s,e:e+r.highlight.e},reverseDelta:t(r.reverseDelta,e)})}}(M||(M={})),function(e){function t(e){return(0,a.ls)((t=>e.find((e=>e.revertId===t.revertId))),p.ij)}e.normalize=function(e){return t=>({...t,highlightBegin:e+t.highlightBegin,highlightEnd:e+t.highlightEnd})},e.findCorrespondingPreview=t,e.hasCorrespondingPreview=function(e){return(0,a.ls)(t(e),p.pC)}}(U||(U={})),function(e){e.getRevertsRange=function(e){return 0===e.length?null:(e.sort(((e,t)=>e.highlightBegin-t.highlightBegin)),{start:e[0].highlightBegin,end:e[e.length-1].highlightEnd})}}(G||(G={}));var Y,$=r(66257),q=r(84161),W=r(88241),z=r(15553),H=r(31157);!function(e){e.IDLE="idle",e.LOADING="loading",e.REPLACING="replacing",e.READY="ready",e.SUCCESS="success"}(Y||(Y={}));const j="no_output",X={type:j},K={current:{previews:[],reverts:[],replacementInfo:p.YP},applied:{reverts:[]}},J={state:Y.IDLE,context:K};class Q{constructor(e={state:J,touchTypistTelemetryService:z.w}){this._params=e,this._state=B.h.create(this._params.state),this._newParagraphsSinceRevert=new WeakMap,this._logger=W.Y.create("TouchTypistStateManagerImpl"),this.state=this._state.view(),this._interrupted=e=>t=>{const{state:r,context:a}=t,s=X;return r!==Y.IDLE?(this._logger.debug("TouchTypistStateManager state reset to idle from",e),[{type:H._.INTERRUPTED},{state:Y.IDLE,context:{current:{previews:[],reverts:[],replacementInfo:p.YP},applied:{reverts:a.applied.reverts}}}]):[s,t]},this._loading=e=>{const{state:t,context:r}=e,a=X;return t===Y.IDLE?(this._logger.debug("TouchTypistStateManager state changed to loading"),[{type:H._.LOADING},{state:Y.LOADING,context:{current:{previews:[],reverts:[],replacementInfo:p.YP},applied:{reverts:r.applied.reverts}}}]):[a,e]},this._responseReceived=({response:e,currentText:t})=>r=>{var a;const{state:s,context:i}=r;if(s===Y.LOADING){if(this._logger.debug("TouchTypistStateManager state changed to ready"),!(null===(a=e.previews)||void 0===a?void 0:a.length))return this._logger.debug("Response has no previews.",{response:e}),this._params.touchTypistTelemetryService.info({message:"Response has no previews.",data:e}),this._interrupted("response_no_previews")(r);const s=M.normalize(e.textScope.begin),n=e.previews.map((r=>{const a=s(r);return{...a,touchTypistId:e.touchTypistId,original:t.slice(a.begin,a.end),highlight:{...a.highlight,text:t.slice(a.highlight.s,a.highlight.e)},relativeReverseDelta:r.reverseDelta}})),o=U.findCorrespondingPreview(n),c=U.normalize(e.textScope.begin),l=e.reverts.reduce(((t,r)=>{const a=o(r);return p.pC(a)&&t.push({...c(r),touchTypistId:e.touchTypistId,highlightText:e.text.slice(r.highlightBegin,r.highlightEnd),isRecent:!0,correspondingPreview:a.value}),t}),[]);l.forEach((e=>{this._newParagraphsSinceRevert.set(e,0)}));const h={current:{...i.current,previews:n,reverts:l,replacementInfo:p.G({replacementText:e.text,replacementTextRange:{start:e.textScope.begin,end:e.textScope.end},delta:(0,$.RZ)(M.offsetDelta(e.delta,e.textScope.begin))})},applied:{reverts:i.applied.reverts}};return[{type:H._.RESPONSE_RECEIVED},{state:Y.READY,context:h}]}return[X,r]},this._responseApplied=e=>{const{state:t,context:r}=e;return t===Y.READY&&p.pC(r.current.replacementInfo)?(this._logger.debug("TouchTypistStateManager state changed to success"),[{type:H._.RESPONSE_APPLIED},{state:Y.SUCCESS,context:{...K,applied:{reverts:[...r.applied.reverts,...r.current.reverts]}}}]):[X,e]},this._previewApplied=e=>t=>{const r=t.context.current.previews.find((t=>t.id===e));if(!r){const r=`Received a "${H._.PREVIEW_APPLIED}" event, but the corresponding preview is missing from the state.`;return this._logger.warn(r,{previewIdInPayload:e,previewsInState:t.context.current.previews}),this._params.touchTypistTelemetryService.warn({message:r,data:{previewIdInPayload:e,previewsInState:t.context.current.previews}}),[{type:H._.PREVIEW_APPLIED},t]}const s=t.context.current.previews.filter((t=>t.id!==e)),i=t.context.current.reverts.filter((t=>t.correspondingPreview.id!==e)),n=M.rebaseByAppliedPreview(r),o=s.map(n),c=(0,a.zG)(t.context.current.replacementInfo,p.UI((e=>{const t=r.end-r.begin,a=r.replacement.length-t;return{...e,replacementTextRange:{...e.replacementTextRange,end:e.replacementTextRange.end+a}}})));return[{type:H._.PREVIEW_APPLIED},{state:s.length>0?Y.READY:Y.IDLE,context:{...t.context,current:{...t.context.current,previews:o,reverts:i,replacementInfo:c}}}]},this._previewDismissed=e=>t=>{if(t.state!==Y.READY)return[X,t];const r=t.context.current.previews.find((t=>t.id===e));if(!r){const r=`Received a "${H._.PREVIEW_DISMISSED}" event, but the corresponding preview is missing from the state.`;return this._logger.warn(r,{previewIdInPayload:e,previewsInState:t.context.current.previews}),this._params.touchTypistTelemetryService.warn({message:r,data:{previewIdInPayload:e,previewsInState:t.context.current.previews}}),[{type:H._.PREVIEW_DISMISSED},t]}const s=t.context.current.previews.filter((e=>e!==r)),i=t.context.current.reverts.find((t=>t.correspondingPreview.id===e)),n=t.context.current.reverts.filter((e=>e!==i)),o=(0,a.zG)(t.context.current.replacementInfo,p.UI((e=>{const t=(0,q.l)(new F.i([...r.relativeReverseDelta.ops]),e.replacementText);return{...e,replacementText:t}})));return[{type:H._.PREVIEW_DISMISSED},{state:0===s.length?Y.IDLE:Y.READY,context:{...t.context,current:{...t.context.current,previews:s,reverts:n,replacementInfo:o}}}]},this._individualRevertApply=e=>t=>{const r=t=>t.filter((t=>t.revertId!==e)),a=r(t.context.applied.reverts);return[{type:H._.REVERT_APPLIED},{state:Y.IDLE,context:{...t.context,current:{...t.context.current,reverts:r(t.context.current.reverts)},applied:{...t.context.applied,reverts:a}}}]},this._userAddedOrRemovedNewlines=e=>{const t=e=>e.filter((e=>{let t=this._newParagraphsSinceRevert.get(e);return void 0===t&&(this._logger.info("Revert has no newParagraphs count, setting to 0",{revert:e}),t=0),t+1!==2&&(this._newParagraphsSinceRevert.set(e,t+1),!0)})),r=t(e.context.current.reverts),a=t(e.context.applied.reverts);return this._logger.debug("_userAddedOrRemovedNewlines",{currentReverts:r,appliedReverts:a}),[{type:H._.USER_ADDED_OR_REMOVED_NEWLINES},{...e,context:{...e.context,current:{...e.context.current,reverts:r},applied:{...e.context.applied,reverts:a}}}]},this._updateReverts=e=>{const t=e.context.applied.reverts.map((e=>({...e,isRecent:!1})));return[{type:H._.UPDATE_REVERTS},{...e,context:{...e.context,applied:{...e.context.current,reverts:t}}}]},this._replacementStarted=e=>e.state!==Y.READY?[X,e]:(this._logger.debug("TouchTypistStateManager state changed to replacing"),[{type:H._.REPLACEMENT_STARTED},{...e,state:Y.REPLACING}]),this._replacementFinished=e=>e.state!==Y.REPLACING?[X,e]:(this._logger.debug("TouchTypistStateManager finished replacing, state changed to ready"),[{type:H._.REPLACEMENT_FINISHED},{...e,state:Y.READY}]),this._transition=e=>{const t=e.name;switch(t){case H._.INTERRUPTED:return this._interrupted(e.payload.source);case H._.RESPONSE_NOT_RECEIVED:return this._interrupted("response_not_received");case H._.LOADING:return this._loading;case H._.RESPONSE_RECEIVED:return this._responseReceived(e.payload);case H._.RESPONSE_APPLIED:return this._responseApplied;case H._.PREVIEW_APPLIED:return this._previewApplied(e.payload.previewId);case H._.PREVIEW_DISMISSED:return this._previewDismissed(e.payload.previewId);case H._.REVERT_APPLIED:return this._individualRevertApply(e.payload.revertId);case H._.USER_ADDED_OR_REMOVED_NEWLINES:return this._userAddedOrRemovedNewlines;case H._.UPDATE_REVERTS:return this._updateReverts;case H._.REPLACEMENT_STARTED:return this._replacementStarted;case H._.REPLACEMENT_FINISHED:return this._replacementFinished;default:(0,E.L0)(t)}},this.handleEvent=e=>{const[t,r]=this._transition(e)(this.state.get());return t.type===j&&this._logger.debug(`Transition [${e.name}] wasn't made because TouchTypistStateManager wasn't in the correct state, current state: [${this.state.get().state}]`),this._state.set(r),t},this.getTouchTypistId=()=>{const e=this.state.get().context.current.previews;return 0===e.length?(this._logger.info("No previews in the state"),null):Number(e[0].touchTypistId)},this.getPreviewsCount=()=>this.state.get().context.current.previews.length,this._logger.debug("TouchTypistStateManager initialized.")}}var Z=r(14765),ee=r(21147),te=r(59833),re=r(66377),ae=r(45439),se=r(39408),ie=r(75155);class ne{constructor(e){var t;this._params=e,this._subs=new s.w,this._previewEq=ee.f7(((e,t)=>e.id===t.id)),this._revertEq=ee.f7(((e,t)=>e.revertId===t.revertId)),this.alertFilter=(t=this._params.alertProcessor,t.alerts.state.view((e=>Object.values(e).filter(Boolean).filter(re.u.is))).pipe(i.U((e=>t=>{if(0===e.length||se.S.isTouchTypistAlert(t))return!0;const r=e.filter((e=>e.kind===re.y.Preview)).flatMap((e=>e.highlightRanges));return!t.highlightRanges.some((e=>r.some((t=>ie.SV.intersects(e,t)))))})))),[this._createTouchTypistStatePreviewsSubscription(),this._createTouchTypistStateRevertsSubscription()].forEach((e=>this._subs.add(e)))}_createTouchTypistStatePreviewsSubscription(){return this._params.touchTypistState.pipe(i.U((({context:e})=>e.current.previews)),m.x()).pipe(Z.O([]),l.G(),o.h((([e,t])=>te.Od(e)||te.Od(t))),i.U((([e,t])=>({previewsToRemove:te.e5(this._previewEq)(t)(e),previewsToAdd:te.e5(this._previewEq)(e)(t)})))).subscribe((({previewsToRemove:e,previewsToAdd:t})=>{e.forEach((e=>this._params.alertProcessor.removeAlert(String(e.id),{_tag:ae.i.alertUpdate}))),t.forEach((e=>this._params.alertProcessor.addAlert(re.u.fromPreview()(e))))}))}_createTouchTypistStateRevertsSubscription(){return this._params.touchTypistState.pipe(i.U((({context:e})=>e.applied.reverts)),m.x()).pipe(Z.O([]),l.G(),o.h((([e,t])=>te.Od(e)||te.Od(t))),i.U((([e,t])=>({revertsToRemove:te.e5(this._revertEq)(t)(e),revertsToUpdate:te.jV(this._revertEq)(e.filter((e=>e.isRecent)))(t.filter((e=>!e.isRecent))),revertsToAdd:te.e5(this._revertEq)(e)(t)})))).subscribe((({revertsToRemove:e,revertsToUpdate:t,revertsToAdd:r})=>{e.forEach((e=>this._params.alertProcessor.removeAlert(String(e.revertId),{_tag:ae.i.alertUpdate}))),t.forEach((e=>{const t={id:String(e.revertId),kind:re.y.Revert};this._params.alertProcessor.changeAlert(t)})),r.forEach((e=>this._params.alertProcessor.addAlert(re.u.fromRevert()(e))))}))}_removeAllTouchTypistAlerts(){this._params.alertProcessor.removeAllAlertsBy(re.u.is,{_tag:ae.i.reset})}dispose(){this._subs.unsubscribe(),this._removeAllTouchTypistAlerts()}}var oe=r(52256),ce=r(86399),le=r(92135),pe=r(72521);var he=r(50664),de=r(78488),ue=r(74857);function ge(e,t,r){return u.T(t.obs.pipe(c.h(null)),e).pipe(Z.O(null),l.G(),n.M(r.state.pipe(i.U((e=>e.state)))),o.h((([[e,t],r])=>[e,t].every((e=>null!==e))&&r!==Y.REPLACING)),i.U((([[,e]])=>e)))}var me,ve,_e,ye=r(64629);!function(e){e.is=function(e){return 1===e.changes.length&&ye.q.isDel(e.changes[0])}}(me||(me={})),function(e){e.is=function(e){return 1===e.changes.length&&ye.q.isIns(e.changes[0])}}(ve||(ve={})),function(e){e.is=function(e){return[ve.is,me.is].some((t=>t(e)))}}(_e||(_e={}));var fe=r(87175);var Te=r(12518);const Ee=e=>{if(ye.q.isIns(e)){return e.pos+e.text.length}if(ye.q.isDel(e)){return e.pos}(0,E.L0)(e)};function be(e,t,r=!1){const s=W.Y.create(`TouchTypist.${be.name}`),i=Ee(e.changes[0]),n=e.newText,o=(0,a.zG)(((e,t)=>{if(t<0||t>e.length)return Te.left(new Error("Caret outside of the text boundaries."));let r=t,a=t;for(;r>0&&"\n"!==e.charAt(r-1);)r--;for(;a<e.length&&"\n"!==e.charAt(a);)a++;return Te.right({start:r,end:a})})(n,i),Te.fold((e=>(s.error("Failed to get paragraph range containing position.",e,{text:n,position:i}),t.error({message:"Failed to get paragraph range containing position.",error:e,data:{text:n,position:i}}),null)),a.yR));if(!o||o.start===o.end)return s.debug("Paragraph containing text change is empty."),p.YP;return o.end===i||r?p.G(o):(s.debug(`Text change end is not at the end of its containing paragraph. Paragraph end: ${o.end}. Text change position: ${i}`),p.YP)}function we(e,t=!1){return r=>r.pipe(i.U((r=>be(r,e,t))))}class Se{constructor(e){this._params=e,this._subs=new s.w,this._activeParagraphRange=B.h.create(p.YP),this._logger=W.Y.create("TouchTypistParagraphServiceImpl"),this.activeParagraphRange=this._activeParagraphRange.view();const t=(r=this._params.textChangesAsync,a=this._params.replacementListener,l=this._params.stateManager,ge(r,a,l).pipe(de.b((()=>{const e=l.state.get().context.applied.reverts;l.handleEvent({name:H._.INTERRUPTED,payload:{source:"create_eligible_text_changes"}}),e.length>0&&l.handleEvent({name:H._.UPDATE_REVERTS})})),o.h((e=>_e.is(e))),ue.b(1e3))).pipe(we(this._params.touchTypistTelemetryService));var r,a,l;const h=function(e,t){return e.pipe(n.M(t.state.pipe(i.U((e=>e.state)))),o.h((([,e])=>e===Y.READY||e===Y.REPLACING)),i.U((([e])=>e)))}(this._params.textChangesAsync,this._params.stateManager).pipe(we(this._params.touchTypistTelemetryService,!0)),d=function(e,t){return e.obs.pipe(n.M(t.state.pipe(i.U((e=>e.state)))),o.h((([e])=>e.source!==fe.P.touchTypist)),de.b((([,e])=>{e===Y.READY&&t.handleEvent({name:H._.INTERRUPTED,payload:{source:"create_ineligible_replacement_changes"}})})),c.h(p.YP))}(this._params.replacementListener,this._params.stateManager);this._subs.add(u.T(t,h,d).pipe(T.skipBy(p.Eh(ie.SV.eq))).subscribe((e=>{this._activeParagraphRange.set(e)})))}getTouchTypistUIPosition(e){this._logger.debug("TouchTypistCaretService.getRangeEndPosition invoked");const t=(0,a.zG)(e,p.UI((e=>{return(t=()=>this._params.textObserver.getCurrentTextMap(),r=this._params.geometryProvider,s=this._params.geometryLayout,e=>(0,a.zG)(p.ij(r.create(e,t(),!0)),p.tS((e=>p.ij(r.getClientRects(e,!0)))),p.tS(le.nI),p.g_((()=>[]),ce.UI((e=>pe.UL.setPosition(s.getCurrentConversionContext().clientToRelative(e),e))))))(e);var t,r,s})),p.UI((e=>e.length>0?e[e.length-1]:null)),p.NG((e=>e?{left:e.right,top:e.top,width:e.width,height:e.height}:null)),p.WG);if(!t)return this._params.touchTypistTelemetryService.info({message:"Failed to get the active paragraph range end position.",data:{paragraphRange:e}}),this._logger.debug("Failed to get the active paragraph range end position. Paragraph range:",oe.QP(e)),null;const r=(0,he.Z)({...t,kind:"offsetPoint"},this._params.textFieldLayout.rect.getCurrent().client,this._params.textFieldLayout.scroll.getCurrent());this._logger.debug("Caret position:",r);const s=t.height+5;return{left:r.left-12.5,top:r.top+s}}dispose(){this._subs.unsubscribe()}}var xe=r(40447),Re=r(83778),Ie=r(99686),Ce=r(70610);class Pe{constructor(e){this._params=e,this._logger=W.Y.create("TouchTypistGDocsIntegration"),this._logger.info("TouchTypist integration for GDocs")}get eventsTargetElement(){const e=(0,Ce.CI)(document);return e||(this._params.telemetry.error({message:"Could not find the target element for text events in GDocs"}),this._logger.error("Could not find the target element for text events"),document.body)}getTouchTypistUIPosition(e){return this._params.paragraphService.getTouchTypistUIPosition(e)}}class Ae{constructor(e){this._params=e,this._logger=W.Y.create("TouchTypistGenericIntegration"),this._logger.info("TouchTypist integration for non-GDocs")}get eventsTargetElement(){return document.body}getTouchTypistUIPosition(e){return this._params.paragraphService.getTouchTypistUIPosition(e)}}var De=r(57005),ke=r(61447),Le=r(73863),Ne=r(10595),Oe=r(44424),Me=r(17071);class Ue{constructor(e){this._params=e,this._logger=W.Y.create("TouchTypistCapiServiceImpl")}triggerTouchTypist(e){const t=this._params.getCheckingService();if(!t)return this._logger.error("Checking service is not available in TouchTypist"),Promise.reject(new Error("Checking service is not available in TouchTypist"));const r={action:"trigger_touch_typist",mode:"GEC_PROGRESSIVE_RECHECK",features:[De.zV.individualPreviewReverts],textScope:e,correlationId:"touch-typist",id:1};return this._params.textChangeBuffer.flush(),(0,a.zG)(t.checkingRevisionInfo,ue.b(100),Le.q(1),Ne.L(1e3,Oe._((()=>{throw this._logger.error("TouchTypist request couldn't be sent because latest revision wasn't emitted"),this._params.touchTypistTelemetryService.error({message:"TouchTypist request couldn't be sent because latest revision wasn't emitted",data:{textScope:e}}),new Error("TouchTypist request couldn't be sent because latest revision wasn't emitted")}))),de.b((()=>{t.sendTouchTypistCommand(r)})),c.h(void 0)).toPromise()}_sendCommand(e,t=!0){const r=this._params.getCheckingService();if(!r)throw this._logger.error("Checking service is not available in TouchTypist"),new Error("Checking service is not available in TouchTypist");return t?r.sendTouchTypistCommand(e):(0,Me.Q1)()}sendTouchTypistPreviewAction(e,t,r){try{this._sendCommand({actionType:e,previewId:r,touchTypistId:t,action:"touch_typist_action",id:1})}catch(t){this._logger.error(`Failed to send touch typist preview action: ${e} for preview id: ${r} with error: ${t}`)}}sendTouchTypistRevertAction(e,t){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:ke.XN.Revert,revertId:t,location:"REVERT_CARD"})}catch(e){this._logger.error(`Failed to send touch typist revert action for revert id: ${t} with an error ${e}`)}}sendTouchTypistApplyAction(e){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:ke.XN.Apply,location:"HOTKEY",hotkey:"TAB"})}catch(t){this._logger.error(`Failed to send touch typist apply action for touch typist id: ${e} with an error ${t}`)}}sendTouchTypistRevertLookAction(e,t){try{this._sendCommand({action:"touch_typist_action",id:1,actionType:ke.XN.RevertLook,touchTypistId:e,revertId:t})}catch(e){this._logger.error(`Failed to send touch typist revert look action for revert id: ${t} with an error ${e}`)}}sendTouchTypistAppearAction(e){try{this._sendCommand({action:"touch_typist_action",id:1,actionType:ke.XN.Appeared,touchTypistId:e})}catch(t){this._logger.error(`Failed to send touch typist appear action for touch typist id: ${e} with an error ${t}`)}}sendTouchTypistSkipAction(e){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:ke.XN.Skipped})}catch(t){this._logger.error(`Failed to send touch typist skip action for touch typist id: ${e} with an error ${t}`)}}}var Ge=r(8748);class Fe{constructor(e){this._params=e,this._subs=new s.w}listeningToHotkeyApply(){this._subs.add(this._params.touchTypistStateValue.pipe(v.w((e=>e===Y.READY?g.R(this._params.targetElement,"keydown",{capture:!0}):Ge.E)),o.h((e=>"Tab"===e.key)),de.b((e=>{e.stopImmediatePropagation(),e.preventDefault()}))).subscribe((()=>{this._params.applyChanges().then((()=>this._params.csActions.incrementTouchTypistUserAcceptedCount()))})))}dispose(){this._subs.unsubscribe()}}var Be=r(5056),Ve=r(49144);class Ye{constructor(e){this._params=e,this._subs=new s.w,this._textChangesObs=new Ve.X({changes:[],prevText:"",newText:"",deltaChange:Be.RI.delta(new F.i)}),this.textChangesAsyncObs=this._textChangesObs.asObservable(),this._subs.add(this._params.textObserver.contentChanges.async.subscribe((e=>{0!==e.changes.length&&this._textChangesObs.next(e)})))}dispose(){this._subs.unsubscribe()}}class $e{constructor(e){this._params=e}async expandedTooltipThreeDotsClicked(){await this._params.gnarClient.touchTypistTooltipClick()}async quickSettingsChangeKeyClicked(){await this._params.gnarClient.touchTypistTooltipEditShortcutButtonClick()}async quickSettingsTurnOffClicked(){await this._params.gnarClient.touchTypistTooltipTurnOffButtonClick()}}var qe=r(80223),We=r(18551),ze=r(47338),He=r(26966),je=r(90377);const Xe=(e,t,r,a)=>ie.SV.translate(ie.SV.rebase(ie.SV.translate(e,-a.start),ye.k.fromDiff(t,r)),a.start);class Ke{constructor(e){this._params=e,this._logger=W.Y.create("TouchTypistReplacementServiceImpl"),this._subs=new s.w,this._replacementInfo=B.h.create(null),this._selectionOrCaretPosition=B.h.create(null),this._subs.add(this._params.stateManager.state.pipe(i.U((e=>e.context.current.replacementInfo)),m.x()).subscribe(qe.wW(this._replacementInfo))),this._subs.add(this._params.selectionOrCaretPosition.pipe(o.h(p.pC),i.U(oe.MH)).subscribe(qe.wW(this._selectionOrCaretPosition)))}canPerformReplacement(e,t){return this._params.replacementService.canPerformReplacement(e,t)}_getApplyType(e,t){return e?"hotkey":t?"individualRevert":"individualPreview"}performReplacement(e,t,r=!0,a=!1){const s=this._getApplyType(r,a),i=B.h.create(null),{pos:n,value:o}=e,c=this._selectionOrCaretPosition.get();if(this.canPerformReplacement({pos:n,oldValue:t,value:o}))return this._params.stateManager.handleEvent({name:H._.REPLACEMENT_STARTED}),this._logger.debug("Perform replacement",{range:n,newText:o,prevText:t,caretPosition:c}),h.Y3((async()=>{const a=Xe(c,t,o,n),l=this._params.textChangesAsync.pipe(We.T(1));this._subs.add(l.subscribe((e=>i.set(e))));const p=await this._params.replacementService.performReplacement(e,{preserveFormatting:!0,touchTypistApplyType:s});if(await i.pipe(ze.n((e=>null===e)),Le.q(1),Ne.L(500,_.of(null))).toPromise()&&!r&&"gDocsCanvas"===this._params.integrationInfo.integrationName&&await this._params.selectionOrCaretPosition.pipe(ue.b(100),Le.q(1)).toPromise(),(0,je.TW)(p)&&this._params.selectionService.setSelection({start:a.start,end:a.end}),this._params.stateManager.handleEvent({name:H._.REPLACEMENT_FINISHED}),!i)throw this._params.touchTypistTelemetryService.error({message:"Text changes emission timed out",data:{replacement:e,prevText:t}}),new Error("Text changes emission timed out");return p}),(r=>{throw this._logger.error("Failed to perform a replacement",r),this._params.touchTypistTelemetryService.error({message:"Failed to perform a replacement",data:{replacement:e,prevText:t,error:String(r)}}),r}));throw this._params.touchTypistTelemetryService.error({message:"Can't perform replacement at this range",data:{replacement:e,prevText:t}}),new Error("Can't perform replacement at this range")}performBatchReplacements(e,t,r){const a=B.h.create(null),{pos:s,value:i}=t,n=this._selectionOrCaretPosition.get();return this._logger.debug("Perform batch replacements",{newText:i,prevText:r,caretPosition:n}),this._params.stateManager.handleEvent({name:H._.REPLACEMENT_STARTED}),h.Y3((async()=>{const o=Xe(n,r,i,s),c=this._params.textChangesAsync.pipe(We.T(1));this._subs.add(c.subscribe((e=>a.set(e))));const l=await this._params.replacementService.performBatchReplacements(e,{preserveFormatting:!0,touchTypistApplyType:"hotkey"});if(await a.pipe(ze.n((e=>null===e)),Le.q(1),Ne.L(500,_.of(null))).toPromise(),await this._params.selectionOrCaretPosition.pipe(ue.b(100),Le.q(1)).toPromise(),this._params.selectionService.setSelection({start:o.start,end:o.end}),this._params.stateManager.handleEvent({name:H._.REPLACEMENT_FINISHED}),!a)throw this._params.touchTypistTelemetryService.error({message:"Text changes emission timed out",data:{replacements:e,singleReplacement:t,prevText:r}}),new Error("Text changes emission timed out");return l}),(a=>{throw this._logger.error("Failed to perform a batch replacement",a),this._params.touchTypistTelemetryService.error({message:"Failed to perform a batch replacement",data:{replacements:e,singleReplacement:t,prevText:r,error:String(a)}}),new Error(`Failed to perform a batch replacement, ${String(a)}`)}))}async applyChanges(){this._logger.info("Apply TouchTypist suggestions");const e=(0,a.zG)(this._replacementInfo.get(),p.g_(a.gn,a.yR));if(e){const t=this._params.textObserver.getCurrentTextMap().getFormatHelper(),r=null==t?void 0:t.getInfo(e.replacementTextRange.start,e.replacementTextRange.end),a=r&&r.footnoteCount,s=r&&r.hyperlinksCount,i=r&&r.smartChipsCount,n=this._params.textObserver.getCurrentTextMap().getPlainText().slice(e.replacementTextRange.start,e.replacementTextRange.end);let o;if(a||s||i){const t=(0,He.g)(e.delta);o=await this.performBatchReplacements(t,{pos:e.replacementTextRange,value:e.replacementText},n)()}else o=await this.performReplacement({pos:e.replacementTextRange,value:e.replacementText},n,!0,!1)();return o&&Te.isRight(o)?this._params.stateManager.handleEvent({name:H._.RESPONSE_APPLIED}):(this._params.touchTypistTelemetryService.info({message:"Failed to apply changes",data:{replacementInfo:e}}),this._params.stateManager.handleEvent({name:H._.INTERRUPTED,payload:{source:"perform_replacement_failed"}}))}return this._params.touchTypistTelemetryService.info({message:"No replacement info to apply changes"}),this._params.stateManager.handleEvent({name:H._.INTERRUPTED,payload:{source:"perform_replacement_no_replacement_info"}})}dispose(){this._subs.unsubscribe()}}class Je{constructor(e){var t,r;this._params=e,this._subs=new s.w,this._disposables=[],this._stateManager=new Q({state:J,touchTypistTelemetryService:this._params.touchTypistTelemetryService}),this._textChangesService=new Ye({geometryLayout:this._params.geometryLayout,geometryProvider:this._params.geometryProvider,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver,selectionOrCaretPosition:this._params.selectionOrCaretPosition}),this._paragraphService=new Se({textChangesAsync:this._textChangesService.textChangesAsyncObs,selectionOrCaretPosition:this._params.selectionOrCaretPosition,replacementListener:this._params.replacementListener,stateManager:this._stateManager,geometryLayout:this._params.geometryLayout,geometryProvider:this._params.geometryProvider,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver,touchTypistTelemetryService:this._params.touchTypistTelemetryService}),this._integration="gDocsCanvas"===this._params.integrationInfo.integrationName?new Pe({paragraphService:this._paragraphService,telemetry:this._params.touchTypistTelemetryService}):new Ae({paragraphService:this._paragraphService,telemetry:this._params.touchTypistTelemetryService}),this._logger=W.Y.create("TouchTypistFeatureImpl"),this._touchTypistState=this._stateManager.state,this._touchTypistCapiService=new Ue({getCheckingService:this._params.getCheckingService,textChangeBuffer:this._params.textChangeBuffer,touchTypistTelemetryService:this._params.touchTypistTelemetryService}),this._replacementService=new Ke({replacementService:this._params.replacementService,textObserver:this._params.textObserver,textChangesAsync:this._textChangesService.textChangesAsyncObs,selectionService:this._params.selectionService,activeParagraphRange:this._paragraphService.activeParagraphRange,selectionOrCaretPosition:this._params.selectionOrCaretPosition,stateManager:this._stateManager,integrationInfo:this._params.integrationInfo,touchTypistTelemetryService:this._params.touchTypistTelemetryService}),this._touchTypistHotkeyManager=new Fe({csActions:this._params.csActions,touchTypistStateValue:this._stateManager.state.pipe(i.U((e=>e.state))),targetElement:this._integration.eventsTargetElement,applyChanges:async()=>{const e=this._stateManager.getTouchTypistId();await this._replacementService.applyChanges(),e&&this._touchTypistCapiService.sendTouchTypistApplyAction(e)}}),this._touchTypistAlertService=new ne({alertProcessor:this._params.alertProcessor,touchTypistState:this._touchTypistState}),this._touchTypistGnarTrackingService=new $e({gnarClient:this._params.gnarClient}),this.alertFilter=this._touchTypistAlertService.alertFilter,this._logger.info("Touch Typist feature is initialized",this._params.integrationInfo),this._disposables.push(this._paragraphService,this._replacementService,this._touchTypistAlertService),this._touchTypistHotkeyManager.listeningToHotkeyApply(),this._disposables.push(this._touchTypistHotkeyManager),this._subs.add(this._paragraphService.activeParagraphRange.pipe(n.M(this._stateManager.state)).pipe(i.U((([e,t])=>{const r=(0,a.zG)(e,p.g_(a.gn,a.yR));r&&t.state===Y.IDLE&&(this._logger.info("Send touch typist trigger event",r),this._stateManager.handleEvent({name:H._.LOADING}),h.Y3((async()=>await this._touchTypistCapiService.triggerTouchTypist({begin:r.start,end:r.end})),(()=>this._stateManager.handleEvent({name:H._.INTERRUPTED,payload:{source:"trigger_touch_typist"}})))())}))).subscribe()),this._subs.add(this._createUserAddedOrRemovedNewlinesSubscription()),this._subs.add(Qe(this._touchTypistState,(()=>this._stateManager.getTouchTypistId()),(e=>this._touchTypistCapiService.sendTouchTypistAppearAction(e)),(e=>this._touchTypistCapiService.sendTouchTypistSkipAction(e)))),this._subs.add((t=this._params.selectionOrCaretPosition,r=this._stateManager,t.pipe(n.M(r.state.pipe(i.U((e=>e.state)))),o.h((([,e])=>e!==Y.REPLACING)),de.b((([,e])=>{e===Y.READY&&r.handleEvent({name:H._.INTERRUPTED,payload:{source:"create_ineligible_selection_changes"}})})),c.h(p.YP))).subscribe())}dispose(){this._disposables.forEach((e=>e.dispose()))}get touchTypistUI(){const e=this._params.csPageState.view((e=>{var t;const r=null!==(t=e.touchTypistState)&&void 0!==t?t:xe.c;return I.kH.get(r.userAcceptedCount)}));return function(e,t,r,a,s,n){const o=u.T(t.scroll.changes,g.R(self,"scroll",{capture:!0})).pipe(c.h(void 0)),l=[Y.LOADING,Y.READY,Y.REPLACING,Y.SUCCESS];return a.pipe(i.U((e=>e.state)),m.x(),v.w((t=>{if(!l.includes(t))return _.of(p.YP);const a=e.activeParagraphRange.pipe(i.U((e=>r.getTouchTypistUIPosition(e))),i.U((e=>e?t===Y.LOADING?p.G(d.createElement(O,{top:e.top,left:e.left})):t===Y.READY||t===Y.REPLACING?p.G(d.createElement(D,{top:e.top,left:e.left,hotkeyName:"Tab",errorsCount:s(),softOnboardingState:n.get()})):t===Y.SUCCESS?p.G(d.createElement(L,{top:e.top,left:e.left})):p.YP:p.YP)));return u.T(o.pipe(y.c(a)),a)})))}(this._paragraphService,this._params.textFieldLayout,this._integration,this._touchTypistState,(()=>this._stateManager.getPreviewsCount()),e)}onTouchTypistTriggerResponse(e){this._logger.debug("TouchTypist TriggerResponse received.",e),this._stateManager.handleEvent({name:H._.RESPONSE_RECEIVED,payload:{response:e,currentText:this._params.textObserver.getTextSource().getPlainText()}})}createPreviewInlineCardModel(e){return new Re.p(e,this._replacementService,this._stateManager,this._touchTypistCapiService,this._params.alertProcessor,this._params.touchTypistTelemetryService)}createRevertInlineCardModel(e){return new Ie.I(e,this._replacementService,this._stateManager,this._touchTypistCapiService)}_createUserAddedOrRemovedNewlinesSubscription(){return ge(this._textChangesService.textChangesAsyncObs,this._params.replacementListener,this._stateManager).pipe(o.h((e=>e.changes.some((e=>e.text.includes("\n"))))),c.h(void 0)).subscribe((()=>{this._stateManager.handleEvent({name:H._.USER_ADDED_OR_REMOVED_NEWLINES})}))}}function Qe(e,t,r,a){let s=null;return e.pipe(l.G()).subscribe((([e,i])=>{const n=t();(n||s)&&(n&&e.state===Y.LOADING&&i.state===Y.READY&&(s=n,r(n)),s&&e.state===Y.READY&&i.state===Y.IDLE&&a(s))}))}},90377:(e,t,r)=>{function a(e){return Boolean(e&&"function"==typeof(null==e?void 0:e[Symbol.iterator]))}function*s(e,t){for(const r of e)t(r)&&(yield r)}function*i(e,t){let r=0;for(const a of e)for(const e of t(a,r++))yield e}function n(e,t,r){let a=0;for(const r of e)if(t(r,a++))return r;return r}function o(e){for(const t of e)return t}function c(e,t){const r=e[Symbol.iterator]();let a=0;const s=t[Symbol.iterator]();let i=0,n=r.next(),o=s.next();return[function*(){for(;!n.done||!o.done;)yield[n.done?null:n.value,o.done?null:o.value,a,i]}(),function(){n=r.next(),a++},function(){o=s.next(),i++}]}function*l(e){let t=e.length;for(;t--;)yield e[t]}r.d(t,{Em:()=>l,TW:()=>a,VS:()=>i,Xh:()=>o,fV:()=>c,hX:()=>s,sE:()=>n})},50845:e=>{e.exports={buttonStyles:"PEP32",menuStyles:"IXNgo",menuStylesLeft:"Z7I_P",textStyles:"Cknts",textStylesLeft:"hsK6j",expandedButtonStyles:"Qbn_Q",expandedButtonContainer:"tUDE2",expandedButtonContainerLeft:"KQIlt",grammarlyLogo:"NgX2S",fadeIn:"WmZVf",hotkeyNameStyles:"MYu59",hotkeyComponentWrapperStyles:"Copl2"}},82675:e=>{e.exports={dot:"KcZm9","dot-blink":"LxClj"}},23729:e=>{e.exports={bubble:"Z2bAs","bubble-scale":"L_Apf",checkmark:"cRf3w","draw-checkmark":"xcjpV"}},77530:(e,t,r)=>{r.d(t,{k:()=>o});var a=r(49231),s=r(73255),i=r(41226),n=r(63178);const o=a.forwardRef((function(e,t){const{utility:r,other:s}=(0,i.a)(e),{accessibilityLabel:o,align:l,as:p,children:h,className:d,direction:u="row",elevation:g,flex:m,gap:v=0,justify:_,wrap:y=!1,style:f={},...T}=s,E=function({direction:e,wrap:t,elevation:r,className:a}){return(0,n.W)("gds-flex","column"===e&&"gds-flex-direction-column",t&&"gds-flex-wrap",r&&`gds-flex-elevation-${r}`,a)}({direction:u,wrap:y,elevation:g,className:d}),b=(0,i.f)(r),w={...c(v),alignItems:l,justifyContent:_,flex:m,...b,...f},S=null!=p?p:"div";return a.createElement(S,{"aria-label":o,ref:t,className:E,style:w,...T},h)}));function c(e){if(null==e)return{};if("number"==typeof e)return{gap:`var(--space-${(0,s.Jy)(e)})`};return{gap:`${null==e.row?"normal":`var(--space-${(0,s.Jy)(e.row)})`} ${null==e.column?"normal":`var(--space-${(0,s.Jy)(e.column)})`}`}}},27765:(e,t,r)=>{r.d(t,{h:()=>l});var a=r(49231),s=r(51007),i=r(63178),n=r(2498),o=r(22394),c=r(94161);const l=a.forwardRef((function(e,t){var r,l;const{buttonProps:p,isPressed:h,ref:d,inProgress:u}=(0,s.zT)(e,t),{isFocusVisible:g,focusProps:m}=(0,n.Fx)();return a.createElement(o.u,{...e.tooltipProps,annotation:e.shortcut},a.createElement(o.aJ,{asChild:!0},a.createElement("button",{className:(0,i.W)((0,s.gj)(e,h,u,g,!0),`gds-icon-button-${e.size||"medium"}`),ref:d,...p,...m,"aria-hidden":e["aria-hidden"],tabIndex:e.tabIndex?e.tabIndex:0},a.createElement(c.J,{icon:e.icon,accessibilityLabel:"",variant:"inherit",size:{small:"small",medium:"medium",large:"large",xlarge:"large"}[e.size||"medium"]}))),a.createElement(o._v,{root:null==(r=e.tooltipContentProps)?void 0:r.root},(null==(l=e.tooltipContentProps)?void 0:l.children)||e.accessibilityLabel))}))},71301:(e,t,r)=>{r.d(t,{v:()=>_});var a=r(49231),s=r(41282),i=r(63178),n=r(79863),o=(e=>(e.Enter="Enter",e.Escape="Escape",e.Tab="Tab",e.ArrowDown="ArrowDown",e.ArrowUp="ArrowUp",e.Space=" ",e))(o||{}),c=r(94161),l=r(59330);var p=r(70440);var h=r(55253),d=r(50319),u=r(22774),g=r(27765),m=r(82509),v=r(66729);const _=(0,n.o)((e=>{const t=(0,p.Me)(e.id),r=(0,p.Me)(e.id),{children:n,activator:c,accessibilityLabel:l="More",initialOpen:_=!1,...y}=e,[f,T]=(0,a.useState)(_),[E,b]=(0,a.useState)(!1),w=(0,a.useRef)(null),S=(0,a.useRef)(null),x=(0,a.useRef)(null);(0,h.Fc)({ref:S,isDisabled:!f,onInteractOutside:(0,a.useCallback)((({target:e})=>{var t;S.current&&!(null==(t=w.current)?void 0:t.contains(e))&&(T(!1),b(!1))}),[])});const{refs:R,floatingStyles:I}=(0,s.YF)({open:f,onOpenChange:T,strategy:"absolute",placement:"bottom-start",middleware:[(0,d.cv)(4),(0,u.RR)({fallbackAxisSideDirection:"start"}),(0,u.uY)({padding:5})],whileElementsMounted:u.Me});(0,a.useEffect)((()=>{w.current&&R.setReference(w.current),S.current&&R.setFloating(S.current)}),[R,f]),(0,a.useEffect)((()=>{if(f&&E&&x.current){const e=x.current.querySelector(".gds-menu-item");null==e||e.focus({preventScroll:!0})}}),[f,E]);const C=(0,a.useCallback)((e=>{var t,r,a,s,i,n;const c=null==(t=x.current)?void 0:t.getRootNode(),l=Array.from((null==(r=x.current)?void 0:r.querySelectorAll(".gds-menu-item"))||[]);if(!l||0===l.length)return;const p=c.activeElement,h=l.indexOf(p);let d=0;switch(e.key){case o.Enter:case o.Space:{e.preventDefault();const t=l[h];null==t||t.click(),T(!1),null==(a=w.current)||a.focus({preventScroll:!0});break}case o.ArrowDown:e.preventDefault(),d=(h+1)%l.length,null==(s=l[d])||s.focus({preventScroll:!0});break;case o.ArrowUp:e.preventDefault(),d=(h-1+l.length)%l.length,null==(i=l[d])||i.focus({preventScroll:!0});break;case o.Escape:case o.Tab:T(!1),null==(n=w.current)||n.focus({preventScroll:!0})}}),[T]),P=(0,a.useCallback)((()=>f?{open:!f}:{}),[f]),A=(0,a.useCallback)((()=>{const e=()=>{T((e=>!e))},s=e=>{var t;switch(e.key){case o.Enter:case o.Space:b(!0),T((e=>!e));break;case o.Escape:case o.Tab:b(!1),T(!1);break;case o.ArrowDown:if(e.preventDefault(),f){const e=null==(t=x.current)?void 0:t.querySelector(".gds-menu-item");null==e||e.focus()}else b(!0),T(!0)}};return"string"==typeof c?a.createElement(g.h,{id:t,icon:"more-vertical"===c?m.D:v.o,variant:"tertiary",accessibilityLabel:l,onClick:e,ref:w,onKeyDown:s,"aria-haspopup":"true","aria-expanded":f,"aria-controls":r,tooltipProps:P()}):a.isValidElement(c)?a.cloneElement(c,{id:t,onClick:e,ref:w,onKeyDown:s,"aria-label":l,"aria-haspopup":"true","aria-expanded":f,"aria-controls":r,tooltipProps:P()}):null}),[c,f,l]),D=(0,a.useCallback)((()=>f&&a.createElement("div",{className:"gds-menu-dropdown",ref:S,style:I},a.createElement("ul",{ref:x,onKeyDown:C,onMouseDown:()=>T(!1),className:(0,i.W)("gds-menu-list",E?"gds-menu-item-pressed":"gds-menu-item-container"),id:r,role:"menu","aria-labelledby":t},a.Children.map(n,(e=>a.isValidElement(e)?a.cloneElement(e):e))))),[f,I,C,E,l,n]);return a.createElement("div",{className:"gds-menu-container",...y},A(),D())}),"Menu",{Item:({children:e,isDisabled:t=!1,icon:r,onClick:s,href:n,target:p})=>a.createElement("li",{className:(0,i.W)("gds-menu-item",t&&"gds-menu-item-disabled"),onMouseDown:e=>{t?e.stopPropagation():null==s||s()},onKeyDown:e=>{e.key!==o.Enter&&e.key!==o.Space||(t?e.stopPropagation():(null==s||s(),n&&self.open(n,p)))},tabIndex:t?-1:0,"aria-disabled":t,role:"menuitem"},r&&a.createElement(c.J,{icon:r,role:"presentation",accessibilityLabel:""}),n?a.createElement("a",{href:n,target:p,className:"gds-menu-item-link"},a.createElement(l.x,{as:"span",variant:"text-small",weight:"medium",marginRight:r?2:0},e)):a.createElement(l.x,{as:"span",variant:"text-small",weight:"medium",marginRight:r?2:0},e)),Separator:({role:e="none"})=>a.createElement("li",{className:"gds-menu-separator",role:e,onClick:e=>{e.stopPropagation()}}),Section:({children:e,label:t,labelDisplay:r="visible"})=>{const s=(0,a.useCallback)((e=>e.stopPropagation()),[]),i=(0,p.Me)();return a.createElement("li",{className:"gds-menu-section",role:"none"},"visible"===r&&t&&a.createElement(l.x,{as:"span",variant:"text-xsmall",color:"base-subdued",className:"gds-menu-section-label",onClick:s,id:i},t),a.createElement("ul",{className:"gds-menu-group",role:"group","aria-labelledby":"visible"===r?i:"","aria-label":"hidden"===r?t:""},e))}})},54763:(e,t,r)=>{function a(e){if(void 0!==e)return"light-green"===e?"var(--light-green)":"yellow-green"===e?"var(--yellow-green)":/-\d\d?\d?$/.test(e)||"white"===e?`var(--${e})`:`var(--color-${e})`}r.d(t,{y:()=>a})},41226:(e,t,r)=>{r.d(t,{a:()=>i,f:()=>n});var a=r(54763),s=r(73255);function i(e){const{bgColor:t,borderColor:r,borderRadius:a,color:s,margin:i,marginLeft:n,marginRight:o,marginTop:c,marginBottom:l,padding:p,paddingLeft:h,paddingRight:d,paddingTop:u,paddingBottom:g,width:m,height:v,..._}=e;return{utility:{bgColor:t,borderColor:r,borderRadius:a,color:s,margin:i,marginLeft:n,marginRight:o,marginTop:c,marginBottom:l,padding:p,paddingLeft:h,paddingRight:d,paddingTop:u,paddingBottom:g,width:m,height:v},other:_}}function n(e){const{bgColor:t,borderColor:r,borderRadius:i,color:n,margin:o,marginLeft:c,marginRight:l,marginTop:p,marginBottom:h,padding:d,paddingLeft:u,paddingRight:g,paddingTop:m,paddingBottom:v,width:_,height:y}=e;return{backgroundColor:(0,a.y)(t),border:void 0!==r?`1px solid var(--color-border-${r})`:void 0,borderRadius:void 0!==i?`var(--radius-${(0,s.Jy)(i)})`:void 0,color:void 0!==n?`var(--color-text-${n})`:void 0,width:"number"==typeof _?`${_}px`:_,height:"number"==typeof y?`${y}px`:y,...(0,s.AA)({margin:o,marginLeft:c,marginRight:l,marginTop:p,marginBottom:h}),...(0,s.VI)({padding:d,paddingLeft:u,paddingRight:g,paddingTop:m,paddingBottom:v})}}},82509:(e,t,r)=>{r.d(t,{D:()=>s});var a=r(49231);const s=(0,r(78021).I)("color",(({title:e,titleId:t,desc:r,descId:s,...i})=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceMoreVertical",stroke:"transparent","aria-labelledby":t,"aria-describedby":s,...i},r?a.createElement("desc",{id:s},r):null,e?a.createElement("title",{id:t},e):null,a.createElement("path",{fill:"#646B81",d:"M9.2 8a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0M9.2 12.8a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0M9.2 3.2a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0"}))))},66729:(e,t,r)=>{r.d(t,{o:()=>s});var a=r(49231);const s=(0,r(78021).I)("color",(({title:e,titleId:t,desc:r,descId:s,...i})=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceMore",stroke:"transparent","aria-labelledby":t,"aria-describedby":s,...i},r?a.createElement("desc",{id:s},r):null,e?a.createElement("title",{id:t},e):null,a.createElement("path",{fill:"#646B81",d:"M8.001 6.8a1.2 1.2 0 1 1 0 2.4 1.2 1.2 0 0 1 0-2.4M12.803 6.8a1.2 1.2 0 1 1 0 2.4 1.2 1.2 0 0 1 0-2.4M3.2 6.8a1.2 1.2 0 1 1 0 2.4 1.2 1.2 0 0 1 0-2.4"}))))},73309:(e,t,r)=>{r.d(t,{p:()=>s});var a=r(49231);const s=(0,r(78021).I)("nocolor",(({title:e,titleId:t,desc:r,descId:s,...i})=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:32,height:32,fill:"none",viewBox:"0 0 32 32","aria-hidden":"true","data-icon":"LogoLogomarkMonochromeDefault",stroke:"transparent","aria-labelledby":t,"aria-describedby":s,...i},r?a.createElement("desc",{id:s},r):null,e?a.createElement("title",{id:t},e):null,a.createElement("path",{fill:"#1C1C1C",d:"M0 16C0 7.163 7.162 0 16.001 0s16 7.163 16 16c0 7.732-5.482 14.183-12.773 15.676-1.042.213-2.121.324-3.222.324H0z"}),a.createElement("path",{fill:"#fff",d:"m19.876 14.484-1.788 2.94h6.02c-.93 5.116-6.62 8.599-12.304 5.653a6.7 6.7 0 0 1-2.861-2.834c-3.27-6.226 1.197-12.49 7.093-12.49a8.19 8.19 0 0 1 6.2 2.839l1.58-2.6a11.08 11.08 0 0 0-8.566-3.148c-5.562.384-10.071 4.994-10.342 10.56-.309 6.393 4.8 11.688 11.124 11.688s11.14-4.999 11.14-11.14c0-.5-.038-.989-.1-1.468z"}))))}}]);